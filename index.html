<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© - Build Questions</title>

<!-- Quill styles -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
    body {
        font-family: Tahoma, Arial, sans-serif;
        margin: 20px;
        background: #f4f4f4;
        direction: rtl;
        text-align: right;
    }
    h1, h2, h3 {
        margin: 10px 0;
    }
    .card {
        background: #ffffff;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    label {
        font-weight: bold;
        display: block;
        margin-top: 5px;
    }
    select, input[type="text"], input[type="password"] {
        width: 100%;
        padding: 6px;
        margin: 5px 0 10px;
        box-sizing: border-box;
    }
    .options-container {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .option-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 10px;
        background: #fafafa;
    }
    .option-title {
        font-weight: bold;
        margin-bottom: 5px;
        color: #333;
    }
    #questionsTable {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: #fff;
    }
    #questionsTable th, #questionsTable td {
        border: 1px solid #ccc;
        padding: 6px;
        text-align: center;
        font-size: 14px;
    }
    #questionsTable th {
        background: #e9ecef;
    }
    button {
        cursor: pointer;
        padding: 6px 10px;
        margin: 3px;
        border-radius: 5px;
        border: none;
        font-size: 14px;
    }
    .btn-main {
        background: #007bff;
        color: white;
    }
    .btn-danger {
        background: #dc3545;
        color: white;
    }
    .btn-secondary {
        background: #6c757d;
        color: white;
    }
    .toolbar-wrapper {
        margin-bottom: 5px;
    }
    #lockArea {
        background: #fff3cd;
        border: 1px solid #ffeeba;
        border-radius: 8px;
        padding: 10px;
        margin-top: 20px;
    }
    #exportArea {
        display: none;
        margin-top: 15px;
    }
    #output {
        width: 100%;
        box-sizing: border-box;
    }
</style>
</head>

<body>

<h1>ğŸ“ Ù†Ø¸Ø§Ù… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© - Build Questions</h1>

<div class="card">
    <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„</h2>

    <label for="name">Ø§Ù„Ù…Ø§Ø¯Ø©</label>
    <select id="name">
        <option value="ÙƒÙ…ÙŠ">ÙƒÙ…ÙŠ</option>
        <option value="Ù„ÙØ¸ÙŠ">Ù„ÙØ¸ÙŠ</option>
        <option value="ØªØ­ØµÙŠÙ„ÙŠ">ØªØ­ØµÙŠÙ„ÙŠ</option>
        <option value="STEP">STEP</option>
    </select>

    <label>Ø§Ù„Ø³Ø¤Ø§Ù„</label>
    <div class="toolbar-wrapper">
        <div id="toolbar-question">
            <span class="ql-formats">
                <button class="ql-bold"></button>
                <button class="ql-italic"></button>
                <button class="ql-underline"></button>
            </span>
            <span class="ql-formats">
                <select class="ql-color"></select>
                <select class="ql-background"></select>
            </span>
            <span class="ql-formats">
                <button class="ql-image"></button>
            </span>
            
            <span class="ql-formats">
                <select class="ql-align"></select>
            </span>
            <span class="ql-formats">
                <select class="ql-size">
                    <option value="small"></option>
                    <option selected></option>
                    <option value="large"></option>
                    <option value="huge"></option>
                </select>
            </span>
        </div>
    </div>
    <div id="editor-question" style="height: 150px; background:#fff;"></div>

    <label>Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</label>
    <input type="text" id="skill" placeholder="Ù…Ø«Ù„: ØªÙ†Ø§Ø¸Ø± Ù„ÙØ¸ÙŠØŒ Ø§Ø³ØªÙ†ØªØ§Ø¬ØŒ Ù…Ù‚Ø§Ø±Ù†Ø©...">

    <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
    <select id="correct">
        <option value="0">A</option>
        <option value="1">B</option>
        <option value="2">C</option>
        <option value="3">D</option>
    </select>
</div>

<div class="card">
    <h2>Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª</h2>
    <div class="options-container">

        <!-- Ø®ÙŠØ§Ø± A -->
        <div class="option-card">
            <div class="option-title">Ø§Ù„Ø®ÙŠØ§Ø± A</div>
            <div class="toolbar-wrapper">
                <div id="toolbar-a">
                    <span class="ql-formats">
                        <button class="ql-bold"></button>
                        <button class="ql-italic"></button>
                        <button class="ql-underline"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-color"></select>
                        <select class="ql-background"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-image"></button>
                    </span>
                  
                    <span class="ql-formats">
                        <select class="ql-align"></select>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-size">
                            <option value="small"></option>
                            <option selected></option>
                            <option value="large"></option>
                            <option value="huge"></option>
                        </select>
                    </span>
                </div>
            </div>
            <div id="editor-a" style="height: 150px; background:#fff;"></div>
        </div>

        <!-- Ø®ÙŠØ§Ø± B -->
        <div class="option-card">
            <div class="option-title">Ø§Ù„Ø®ÙŠØ§Ø± B</div>
            <div class="toolbar-wrapper">
                <div id="toolbar-b">
                    <span class="ql-formats">
                        <button class="ql-bold"></button>
                        <button class="ql-italic"></button>
                        <button class="ql-underline"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-color"></select>
                        <select class="ql-background"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-image"></button>
                    </span>
                  
                    <span class="ql-formats">
                        <select class="ql-align"></select>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-size">
                            <option value="small"></option>
                            <option selected></option>
                            <option value="large"></option>
                            <option value="huge"></option>
                        </select>
                    </span>
                </div>
            </div>
            <div id="editor-b" style="height: 150px; background:#fff;"></div>
        </div>

        <!-- Ø®ÙŠØ§Ø± C -->
        <div class="option-card">
            <div class="option-title">Ø§Ù„Ø®ÙŠØ§Ø± C</div>
            <div class="toolbar-wrapper">
                <div id="toolbar-c">
                    <span class="ql-formats">
                        <button class="ql-bold"></button>
                        <button class="ql-italic"></button>
                        <button class="ql-underline"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-color"></select>
                        <select class="ql-background"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-image"></button>
                    </span>
                 
                    <span class="ql-formats">
                        <select class="ql-align"></select>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-size">
                            <option value="small"></option>
                            <option selected></option>
                            <option value="large"></option>
                            <option value="huge"></option>
                        </select>
                    </span>
                </div>
            </div>
            <div id="editor-c" style="height: 150px; background:#fff;"></div>
        </div>

        <!-- Ø®ÙŠØ§Ø± D -->
        <div class="option-card">
            <div class="option-title">Ø§Ù„Ø®ÙŠØ§Ø± D</div>
            <div class="toolbar-wrapper">
                <div id="toolbar-d">
                    <span class="ql-formats">
                        <button class="ql-bold"></button>
                        <button class="ql-italic"></button>
                        <button class="ql-underline"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-color"></select>
                        <select class="ql-background"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-image"></button>
                    </span>
                
                    <span class="ql-formats">
                        <select class="ql-align"></select>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-size">
                            <option value="small"></option>
                            <option selected></option>
                            <option value="large"></option>
                            <option value="huge"></option>
                        </select>
                    </span>
                </div>
            </div>
            <div id="editor-d" style="height: 150px; background:#fff;"></div>
        </div>

    </div>

    <button class="btn-main" onclick="addQuestion()">â• Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</button>
    <button class="btn-secondary" onclick="uploadToFirebase()">â˜ Ø­ÙØ¸ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
</div>
<!-- Ø¬Ø¯ÙˆÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© -->
<div class="card">
    <h2>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h2>
    <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…</label>
<select id="filterSelect" onchange="renderQuestionsTable()">
    <option value="all">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
    <option value="ÙƒÙ…ÙŠ">ÙƒÙ…ÙŠ</option>
    <option value="Ù„ÙØ¸ÙŠ">Ù„ÙØ¸ÙŠ</option>
    <option value="ØªØ­ØµÙŠÙ„ÙŠ">ØªØ­ØµÙŠÙ„ÙŠ</option>
    <option value="STEP">STEP</option>
</select>

    <table id="questionsTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Ø§Ù„Ù…Ø§Ø¯Ø©</th>
                <th>Ø§Ù„Ø³Ø¤Ø§Ù„</th>
                <th>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</th>
                <th>ØªØ¹Ø¯ÙŠÙ„</th>
                <th>Ø­Ø°Ù</th>
            </tr>
        </thead>
        <tbody id="questionsTableBody"></tbody>
    </table>
</div>

<!-- Firebase + Quill + html2canvas -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase â€” Ø¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù‡Ù†Ø§
var firebaseConfig = {
  apiKey: "AIzaSyD-xxxxxxxxxxxxxxxxxxxx",
  authDomain: "quiz-262a8.firebaseapp.com",
  databaseURL: "https://quiz26-caf2f-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "quiz-262a8",
  storageBucket: "quiz-262a8.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123456789:web:xxxxxxxxxxxx"
};
firebase.initializeApp(firebaseConfig);
const storage = firebase.storage();
// Ø±ÙØ¹ Ù…Ù„Ù Ø¥Ù„Ù‰ Firebase Storage ÙˆØ¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø·
function uploadImageToStorage(file) {
    return new Promise((resolve, reject) => {
        const fileName = "q_" + Date.now() + "_" + Math.floor(Math.random() * 99999) + ".png";
        const storageRef = storage.ref("questions/" + fileName);

        storageRef.put(file).then(snapshot => {
            snapshot.ref.getDownloadURL().then(url => resolve(url));
        }).catch(err => reject(err));
    });
}

// ØªÙØ¹ÙŠÙ„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¯Ø§Ø®Ù„ Ù…Ø­Ø±Ø± Quill
function enableImageAutoUpload(quill) {

    // Ø¹Ù†Ø¯ Ø§Ù„Ù„ØµÙ‚ (Ù†Ø³Ø®Ø© Ù…Ø­Ø³Ù‘Ù†Ø© ØªØ¯Ø¹Ù… Snipping Tool Ùˆ PrintScreen)
    quill.root.addEventListener("paste", async function (e) {
        const clipboard = e.clipboardData || window.clipboardData;
        if (!clipboard) return;

        // 1) Ø¯Ø¹Ù… clipboard.items (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©)
        if (clipboard.items) {
            for (let item of clipboard.items) {
                if (item.type.indexOf("image") !== -1) {
                    e.preventDefault();
                    const file = item.getAsFile();
                    const url = await uploadImageToStorage(file);
                    const range = quill.getSelection(true);
                    quill.insertEmbed(range.index, "image", url);
                    return;
                }
            }
        }

        // 2) Ø¯Ø¹Ù… clipboard.files (Ù…Ù‡Ù… Ø¬Ø¯Ù‹Ø§ Ù„Ù„Ù‚ØµÙ‘)
        const file = clipboard.files?.[0];
        if (file && file.type.startsWith("image/")) {
            e.preventDefault();
            const url = await uploadImageToStorage(file);
            const range = quill.getSelection(true);
            quill.insertEmbed(range.index, "image", url);
        }
    });

    // Ø¹Ù†Ø¯ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
    quill.root.addEventListener("drop", async function (e) {
        e.preventDefault();
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith("image/")) {
            const url = await uploadImageToStorage(file);
            const range = quill.getSelection(true);
            quill.insertEmbed(range.index, "image", url);
        }
    });
}


// Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Firebase
let firebaseQuestions = {};

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Firebase Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
function loadQuestions() {
    firebase.database().ref("build_questions").on("value", snapshot => {
        firebaseQuestions = snapshot.val() || {};
        renderQuestionsTable();
    });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
function renderQuestionsTable() {
    const tbody = document.getElementById("questionsTableBody");
    tbody.innerHTML = "";

    let index = 1;

    const filter = document.getElementById("filterSelect").value;

for (let key in firebaseQuestions) {
    let q = firebaseQuestions[key];

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±
    if (filter !== "all" && q.name !== filter) continue;


        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Øµ Ø¨Ø³ÙŠØ· Ù…Ù† Ø§Ù„Ø³Ø¤Ø§Ù„
        let tempDiv = document.createElement("div");
        tempDiv.innerHTML = q.q;
        let plainText = tempDiv.textContent || tempDiv.innerText || "";

        let tr = document.createElement("tr");
        tr.id = "row-" + key;

        tr.innerHTML = `
            <td>${index++}</td>
            <td>${q.name}</td>
            <td style="max-width:250px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${plainText}</td>
            <td>${["A","B","C","D"][q.correct]}</td>
            <td><button class="btn-secondary" onclick="editRow('${key}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button></td>
            <td><button class="btn-danger" onclick="deleteRow('${key}')">ğŸ—‘ Ø­Ø°Ù</button></td>
        `;

        tbody.appendChild(tr);
    }
}

// Ø­Ø°Ù Ø³Ø¤Ø§Ù„ Ù…Ù† Firebase
function deleteRow(key) {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ")) return;

    firebase.database().ref("build_questions/" + key).remove()
        .then(() => alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­"))
        .catch(err => alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù"));
}

// ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ
function editRow(key) {
    let q = firebaseQuestions[key];
    let tr = document.getElementById("row-" + key);

    tr.innerHTML = `
        <td colspan="6">
            <div class="card" style="background:#eef7ff;">
                <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„</h3>

                <label>Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                <div id="toolbar-edit-q-${key}"></div>
                <div id="editor-edit-q-${key}" style="height:150px; background:#fff;"></div>

                <label>Ø§Ù„Ø®ÙŠØ§Ø± A</label>
                <div id="toolbar-edit-a-${key}"></div>
                <div id="editor-edit-a-${key}" style="height:150px; background:#fff;"></div>

                <label>Ø§Ù„Ø®ÙŠØ§Ø± B</label>
                <div id="toolbar-edit-b-${key}"></div>
                <div id="editor-edit-b-${key}" style="height:150px; background:#fff;"></div>

                <label>Ø§Ù„Ø®ÙŠØ§Ø± C</label>
                <div id="toolbar-edit-c-${key}"></div>
                <div id="editor-edit-c-${key}" style="height:150px; background:#fff;"></div>

                <label>Ø§Ù„Ø®ÙŠØ§Ø± D</label>
                <div id="toolbar-edit-d-${key}"></div>
                <div id="editor-edit-d-${key}" style="height:150px; background:#fff;"></div>

                <label>Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</label>
                <input type="text" id="edit-skill-${key}" value="${q.skill || ""}">

                <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                <select id="edit-correct-${key}">
                    <option value="0" ${q.correct==0?"selected":""}>A</option>
                    <option value="1" ${q.correct==1?"selected":""}>B</option>
                    <option value="2" ${q.correct==2?"selected":""}>C</option>
                    <option value="3" ${q.correct==3?"selected":""}>D</option>
                </select>

                <button class="btn-main" onclick="saveEdit('${key}')">ğŸ’¾ Ø­ÙØ¸</button>
                <button class="btn-secondary" onclick="cancelEdit()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </td>
    `;

    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø±Ø±Ø§Øª Quill Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
    createEditQuill(key, q);
}

// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø±Ø±Ø§Øª Quill Ø¯Ø§Ø®Ù„ Ø§Ù„ØµÙ
function createEditQuill(key, q) {
    window["quill_edit_q_" + key] = new Quill(`#editor-edit-q-${key}`, {
        theme: 'snow',
        modules: { toolbar: `#toolbar-edit-q-${key}` }
    });
    window["quill_edit_q_" + key].root.innerHTML = q.q;

    window["quill_edit_a_" + key] = new Quill(`#editor-edit-a-${key}`, {
        theme: 'snow',
        modules: { toolbar: `#toolbar-edit-a-${key}` }
    });
    window["quill_edit_a_" + key].root.innerHTML = q.a;

    window["quill_edit_b_" + key] = new Quill(`#editor-edit-b-${key}`, {
        theme: 'snow',
        modules: { toolbar: `#toolbar-edit-b-${key}` }
    });
    window["quill_edit_b_" + key].root.innerHTML = q.b;

    window["quill_edit_c_" + key] = new Quill(`#editor-edit-c-${key}`, {
        theme: 'snow',
        modules: { toolbar: `#toolbar-edit-c-${key}` }
    });
    window["quill_edit_c_" + key].root.innerHTML = q.c;

    window["quill_edit_d_" + key] = new Quill(`#editor-edit-d-${key}`, {
        theme: 'snow',
        modules: { toolbar: `#toolbar-edit-d-${key}` }
    });
    window["quill_edit_d_" + key].root.innerHTML = q.d;
    enableImageAutoUpload(window["quill_edit_q_" + key]);
enableImageAutoUpload(window["quill_edit_a_" + key]);
enableImageAutoUpload(window["quill_edit_b_" + key]);
enableImageAutoUpload(window["quill_edit_c_" + key]);
enableImageAutoUpload(window["quill_edit_d_" + key]);
}

// Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
function cancelEdit() {
    renderQuestionsTable();
}

// Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
function saveEdit(key) {
    let updated = {
        name: firebaseQuestions[key].name,
        q: window["quill_edit_q_" + key].root.innerHTML,
        a: window["quill_edit_a_" + key].root.innerHTML,
        b: window["quill_edit_b_" + key].root.innerHTML,
        c: window["quill_edit_c_" + key].root.innerHTML,
        d: window["quill_edit_d_" + key].root.innerHTML,
        skill: document.getElementById("edit-skill-" + key).value,
        correct: Number(document.getElementById("edit-correct-" + key).value)
    };

    firebase.database().ref("build_questions/" + key).update(updated)
        .then(() => {
            alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
            loadQuestions();
        })
        .catch(err => alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸"));
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadQuestions();
</script>
<!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„Ù… -->
<div id="lockArea" class="card">
    <h3>ğŸ”’ Ù…Ù†Ø·Ù‚Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø¹Ù„Ù…</h3>
    <p>Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø®Ø§ØµØ© Ø¨Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ Ù…Ø­Ù…ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.</p>
    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
    <input type="password" id="passwordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="btn-secondary" onclick="unlockJSON()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØµØ¯ÙŠØ± -->
<div id="exportArea" class="card">
    <h3>ğŸ“¦ ØªØµØ¯ÙŠØ± ÙˆØ±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
    <button class="btn-main" onclick="exportJSON()">ğŸ“„ ØªØµØ¯ÙŠØ± JSON (build_questions.json)</button>
    
    <h3>ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Excel</h3>
<input type="file" id="excelFile" accept=".xlsx, .xls">
<button class="btn-main" onclick="importExcel()">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù† Excel</button>
<button class="btn-secondary" onclick="uploadImported()">â˜ Ø±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø©</button>

<br><br>
<div id="importStatus" style="color:green; font-weight:bold;"></div>

    <br><br>
    <label>Ù…Ø­ØªÙˆÙ‰ JSON Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
    <textarea id="output" rows="12"></textarea>
</div>

<script>
// Ù…Ø­Ø±Ø±Ø§Øª Quill Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯)
var quillQuestion = new Quill('#editor-question', {
  theme: 'snow',
  modules: { toolbar: '#toolbar-question' }
});
var quillA = new Quill('#editor-a', {
  theme: 'snow',
  modules: { toolbar: '#toolbar-a' }
});
var quillB = new Quill('#editor-b', {
  theme: 'snow',
  modules: { toolbar: '#toolbar-b' }
});
var quillC = new Quill('#editor-c', {
  theme: 'snow',
  modules: { toolbar: '#toolbar-c' }
});
var quillD = new Quill('#editor-d', {
  theme: 'snow',
  modules: { toolbar: '#toolbar-d' }
});
enableImageAutoUpload(quillQuestion);
enableImageAutoUpload(quillA);
enableImageAutoUpload(quillB);
enableImageAutoUpload(quillC);
enableImageAutoUpload(quillD);

// Ø²Ø± Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø§Ø´Ø©


// Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹)
let newQuestions = [];

// Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯
function addQuestion() {
    const name = document.getElementById("name").value;
    const skill = document.getElementById("skill").value.trim();
    const correct = Number(document.getElementById("correct").value);

    const qHtml = quillQuestion.root.innerHTML.trim();
    const aHtml = quillA.root.innerHTML.trim();
    const bHtml = quillB.root.innerHTML.trim();
    const cHtml = quillC.root.innerHTML.trim();
    const dHtml = quillD.root.innerHTML.trim();

    if (!qHtml || qHtml === "<p><br></p>") {
        alert("Ø±Ø¬Ø§Ø¡Ù‹ Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„.");
        return;
    }

    let newQ = {
        name: name,
        q: qHtml,
        a: aHtml,
        b: bHtml,
        c: cHtml,
        d: dHtml,
        correct: correct,
        skill: skill
    };

    newQuestions.push(newQ);
    alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.");

    quillQuestion.setContents([]);
    quillA.setContents([]);
    quillB.setContents([]);
    quillC.setContents([]);
    quillD.setContents([]);
    document.getElementById("skill").value = "";
    document.getElementById("correct").value = 0;
}

// ÙØªØ­ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØµØ¯ÙŠØ±
function unlockJSON() {
    const pass = document.getElementById("passwordInput").value;
    const correctPass = "teacher123"; // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡

    if (pass === correctPass) {
        document.getElementById("exportArea").style.display = "block";
        document.getElementById("lockArea").style.display = "none";
    } else {
        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }
}

// ØªØµØ¯ÙŠØ± JSON
function exportJSON() {
    let materialsMap = {};

    for (let key in firebaseQuestions) {
        let q = firebaseQuestions[key];

        if (!materialsMap[q.name]) {
            materialsMap[q.name] = { name: q.name, questions: [] };
        }

        materialsMap[q.name].questions.push({
            q: q.q,
            a: q.a,
            b: q.b,
            c: q.c,
            d: q.d,
            correct: q.correct,
            skill: q.skill
        });
    }

    let finalArray = Object.values(materialsMap);
    document.getElementById("output").value = JSON.stringify(finalArray, null, 4);
}
let importedQuestions = [];

function importExcel() {
    let file = document.getElementById("excelFile").files[0];
    if (!file) {
        alert("Ø§Ø®ØªØ± Ù…Ù„Ù Excel Ø£ÙˆÙ„Ø§Ù‹");
        return;
    }

    let reader = new FileReader();
    reader.onload = function(e) {
        let data = new Uint8Array(e.target.result);
        let workbook = XLSX.read(data, { type: "array" });

        let sheet = workbook.Sheets[workbook.SheetNames[0]];
        let json = XLSX.utils.sheet_to_json(sheet);

        importedQuestions = json.map(row => ({
            name: row.name || "",
            q: row.q || "",
            a: row.a || "",
            b: row.b || "",
            c: row.c || "",
            d: row.d || "",
            correct: Number(row.correct),
            skill: row.skill || ""
        }));

        document.getElementById("importStatus").innerHTML =
            "âœ” ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ " + importedQuestions.length + " Ø³Ø¤Ø§Ù„ Ù…Ù† Excel";
    };

    reader.readAsArrayBuffer(file);
}
function uploadImported() {
    if (importedQuestions.length === 0) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…Ø³ØªÙˆØ±Ø¯Ø©.");
        return;
    }

    const ref = firebase.database().ref("build_questions");
    let updates = {};

    importedQuestions.forEach(q => {
        let newRef = ref.push();
        updates[newRef.key] = q;
    });

    ref.update(updates)
        .then(() => {
            alert("âœ” ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø³ØªÙˆØ±Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­");
            importedQuestions = [];
            document.getElementById("importStatus").innerHTML = "";
        })
        .catch(err => alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹"));
}

// Ø±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
function uploadToFirebase() {
    if (newQuestions.length === 0) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø±ÙØ¹Ù‡Ø§.");
        return;
    }

    const ref = firebase.database().ref("build_questions");
    let updates = {};

    newQuestions.forEach(q => {
        let newRef = ref.push();
        updates[newRef.key] = q;
    });

    ref.update(updates)
        .then(() => {
            alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­.");
            newQuestions = [];
        })
        .catch(err => alert("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹"));
}
</script>

</body>
</html>